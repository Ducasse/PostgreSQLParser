as yet unclassified
testCreateView55
	self
		parse: 'CREATE VIEW battle_view AS SELECT issue.id AS issue_id, winning_initiative.id AS winning_initiative_id, losing_initiative.id AS losing_initiative_id, sum( CASE WHEN (COALESCE(better_vote.grade, 0) > COALESCE(worse_vote.grade, 0)) THEN direct_voter.weight ELSE 0 END) AS count FROM (((((issue LEFT JOIN direct_voter ON ((issue.id = direct_voter.issue_id))) JOIN battle_participant winning_initiative ON ((issue.id = winning_initiative.issue_id))) JOIN battle_participant losing_initiative ON ((issue.id = losing_initiative.issue_id))) LEFT JOIN vote better_vote ON (((direct_voter.member_id = better_vote.member_id) AND (winning_initiative.id = better_vote.initiative_id)))) LEFT JOIN vote worse_vote ON (((direct_voter.member_id = worse_vote.member_id) AND (losing_initiative.id = worse_vote.initiative_id)))) WHERE (((issue.state = ''voting''::issue_state) AND (issue.phase_finished IS NOT NULL)) AND ((winning_initiative.id <> losing_initiative.id) OR (((winning_initiative.id IS NOT NULL) AND (losing_initiative.id IS NULL)) OR ((winning_initiative.id IS NULL) AND (losing_initiative.id IS NOT NULL))))) GROUP BY issue.id, winning_initiative.id, losing_initiative.id' rule: #createViewCommand